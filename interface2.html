<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<script>
// Déclaration de la variable contenant les données CSV
const data = [];

// Utilisation de D3.js pour charger le fichier CSV
d3.csv('src\\data\\quentin_population_album.csv').then(csvData => {
  // À ce stade, les données CSV sont stockées dans la variable "csvData".

  // Parcourir les données et nettoyer la colonne "Nombre d'albums" si nécessaire
  csvData.forEach(entry => {
    if (entry["Nombre d'albums"]) {
      entry["Nombre d'albums"] = entry["Nombre d'albums"].replace(/\D+$/, '');
    }
  });

  createStackedChart(csvData); // Appel de la fonction pour créer le graphique
});

// Fonction pour créer le graphique empilé
function createStackedChart(data) {
  // Dimensions du graphique
  const width = 1200;
  const height = 4200;
  const marginTop = 30;
  const marginRight = 10;
  const marginBottom = 20;
  const marginLeft = 120;

  // Création de l'élément SVG
  const svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  // Supprimez ou modifiez cette partie si nécessaire
  // Elle définit la plage de couleurs pour les séries
  const color = d3.scaleOrdinal(d3.schemeCategory10);

  // Créez une échelle pour l'axe X (correspondant au nombre d'albums)
  const x = d3.scaleLinear()
    .domain([0, d3.max(data, d => +d["Nombre d'albums"])])
    .range([marginLeft, width - marginRight]);

  // Créez une échelle pour l'axe Y (correspondant au genre)
  const y = d3.scaleBand()
    .domain(data.map(d => d.Genre))
    .range([marginTop, height - marginBottom])
    .padding(0.1);

  // Créez un groupe pour les barres empilées
  const g = svg.append("g");

  // Utilisez D3 pour empiler les données par année
  const stack = d3.stack()
    .keys(["Nombre d'albums"])
    .order(d3.stackOrderNone)
    .offset(d3.stackOffsetNone);

  const stackedData = stack(data);

  // Créez les barres empilées
  g.selectAll(".bar")
    .data(stackedData)
    .enter().append("g")
    .attr("fill", d => color(d.key))
    .selectAll("rect")
    .data(d => d)
    .enter().append("rect")
    .attr("x", d => x(d[0]))
    .attr("y", d => y(d.data.Genre))
    .attr("width", d => x(d[1]) - x(d[0]))
    .attr("height", y.bandwidth());

  // Ajoutez un axe X en haut
  svg.append("g")
    .attr("class", "x-axis")
    .attr("transform", "translate(0," + marginTop + ")")
    .call(d3.axisTop(x));

  // Ajoutez un axe Y à gauche
  svg.append("g")
    .attr("class", "y-axis")
    .attr("transform", "translate(" + marginLeft + ",0)")
    .call(d3.axisLeft(y));
}

</script>

</body>
</html>
